pipeline {
	environment {
		registry = 'samnur82/simpleapp'
		registryCred = 'my_dockerhub'
		dockerImage = ''
	}
	
    agent any
    stages {
        stage('clone repo') {
            steps {
                sh 'git checkout docker-dockerfiletest' 
            }
        }
        stage('build Image') {
            steps {
		script {
                    dockerImage = docker.build("${registry}:$BUILD_NUMBER", "--no-cache .")
		}
            }
        }
        stage('test image'){
            steps{
		sh 'docker image ls -a'
                sh 'pwd | java -version'
            }
	}
	stage('push image'){
            steps{
		script {
                    docker.withRegistry( '', registryCred ) {
			dockerImage.push()

                        dockerImage.push('latest')
                    }
		}	
	    }
	}
    }
}